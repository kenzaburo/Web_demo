<?php    session_start();	    require_once('define.inc.php');		require_once(STL_CLASS.'STL_MainAdmin.php');	require_once (STL_CLASS . 'stl_UploadFile.php');	$view = new View();	if(!isset($_SESSION['admin_User']))	{		header('Location:'.'login.php');		exit();	}    $oDB = new STL_MainAdmin();	if(isset($_REQUEST['pTable'])){		$_SESSION['pTable'] = $_REQUEST['pTable'];		$pTable = $_REQUEST['pTable'];	}else{		$pTable = $_SESSION['pTable'];	}	switch($pTable){		case 1: /*table*/			$oDB->attTableName = "p_table";			$dirPhoto = "table";		break;		case 2: /*sofa*/			$oDB->attTableName = "p_sofa";			$dirPhoto = "sofa";		break;		case 3: /*marquetry*/			$oDB->attTableName = "p_marquetry";			$dirPhoto = "marquetry";		break;		case 4: /*door*/			$oDB->attTableName = "p_door";			$dirPhoto = "door";		break;		case 5: /*chair*/			$oDB->attTableName = "p_chair";			$dirPhoto = "chair";		break;		case 6: /*cabinet_television*/			$oDB->attTableName = "p_cabinet_television";			$dirPhoto = "cabinet_television";		break;		case 7: /*cabinet_shoe*/			$oDB->attTableName = "p_cabinet_shoe";			$dirPhoto = "cabinet_shoe";		break;		case 8: /*cabinet_cooker*/			$oDB->attTableName = "p_cabinet_cooker";			$dirPhoto = "cabinet_cooker";		break;		case 9: /*cabinet_coat*/			$oDB->attTableName = "p_cabinet_coat";			$dirPhoto = "cabinet_coat";		break;		case 10: /*bookshelf*/			$oDB->attTableName = "p_bookself";			$dirPhoto = "bookshelf";		break;		case 11: /*bestseller*/			$oDB->attTableName = "p_bestseller";			$dirPhoto = "bestseller";		break;		case 12: /*bed*/			$oDB->attTableName = "p_bed";			$dirPhoto = "bed";		break;		case 13:/*whathot*/			$oDB->attTableName = "p_whathot";			$dirPhoto = "whathot";		break;		default:			$oDB->attTableName = "p_table";			$dirPhoto = "table";		break;	}	define ('DIR_PHOTO',"../data/".$dirPhoto."/");	define ('DIR_PHOTO_TEMP',"../data/temp/");	/*paging*/    $numOfRecord = 10;	if (isset($_REQUEST['Page'])){		$page = $_REQUEST['Page'];	}else{		$page = 1;	}    $start  = ($page - 1) * $numOfRecord;    $paging                     = new paging();    $rowinpage                  = $numOfRecord;    $paging->align_links_count  = 4;	/*end paging*/    $p = $_POST["p"];    switch($p){				case 'popup':						$p = new STL_UploadFile();			$p->uploadDIR = DIR_PHOTO_TEMP;			$p->photo = $_FILES['file'];							$photoName = "";			$err = "";							$p->stl_DeleteFile(DIR_PHOTO_TEMP . $_SESSION['PhotoNameC']);							$photoName = $p->stl_UploadedFile();												if ($photoName == '1' || $photoName == '2' || $photoName == '3' ||$photoName == '4')				$err = $photoName;			else{				$err = '5';				$resize = $p->stl_AutoResize(DIR_PHOTO_TEMP.$photoName,150);				$_SESSION['PhotoNameC'] = $photoName;			}			$result = $err . ";" . $photoName . ";" . $resize['type'] . ";" . $resize['size'];						echo "<script>parent.parent.ArtistComposer.stl_UploadResult('" . $result . "');</script>";		break;				case 7:/*show add new screen*/					$dataRow["ID"]        = "";            $dataRow["Name"]       = "";            $dataRow["Description"]     = "";            $dataRow["Price"]   = "";            $dataRow["Image"]  = "default.gif";			$dataRow['MOD_IMG'] 	= STL_IMG . "";			$dataRow['MOD_DATA'] 	= STL_DATA . "";			$dataRow['pTable']		= $dirPhoto;			echo $view->returnTmpl(STL_TMPL."updateInfo.tmpl", 'n', $dataRow);		break;    	case 6:/*show update screen*/			$ID = $_POST['ID'];			$row = $oDB->stl_GetRecordInfo($ID);            $dataRow["ID"]        = $row->ID;            $dataRow["Name"]       = htmlspecialchars($row->Name, ENT_QUOTES);            $dataRow["Description"]     = htmlspecialchars($row->Description, ENT_QUOTES);            $dataRow["Price"]   = htmlspecialchars($row->Price, ENT_QUOTES);            $dataRow["Image"]  = $row->Image == "" ? "default.gif":$row->Image;			$dataRow['MOD_IMG'] 	= STL_IMG . "";			$dataRow['MOD_DATA'] 	= STL_DATA . "";			$dataRow['pTable']		= $dirPhoto;			echo $view->returnTmpl(STL_TMPL."updateInfo.tmpl", 'n', $dataRow);		break;        case 5:/*add new artist*/            $arrinfo = stripslashes($_POST['arrInfo']);			$arrInfoImage = json_decode($arrinfo);            $result = $oDB->stl_addNewP($arrinfo);            if("NG" == $result){                echo 1;            }else if("OK" == $result){                if ($arrInfoImage[3]!=""){                    $p = new STL_UploadFile();					if(file_exists(DIR_PHOTO_TEMP.$arrInfoImage[3])){						rename(DIR_PHOTO_TEMP.$arrInfoImage[3], DIR_PHOTO.$arrInfoImage[3]);												$p->stl_DeleteFile(DIR_PHOTO_TEMP . $arrInfoImage[3]);					}					                }                echo 2;            }else{				echo 3;			}        break;        case 4:/*search*/			            $arrInfo = stripslashes($_POST['arrInfo']);            $arrData = $oDB->stl_GetRecordS($arrInfo, $start, $numOfRecord);            $totalRecord = $oDB->stl_TotalRecordS($arrInfo);            $content = stl_printData($dirPhoto, $arrData, STL_TMPL, $view, $start);            if("" == $content)            $content = "<div style='text-align:center;'>Không có kết quả nào được tìm thấy!</div>";            $paging->assign($page,"onclick=\"ArtistComposer.stl_PagingS([:page:])\"" ,  $totalRecord , $rowinpage );            $arrResponse = array('content'=>$content,'paging'=>$paging->fetch());			$arrResponse = json_encode($arrResponse);            echo $arrResponse;        break;        case 3:             $ID         = $_POST['ID'];			$IsDeleted  = $_POST['IsDeleted'];            $result = $oDB->stl_DeleteRecord($ID, $IsDeleted);            echo $result;        break;        case 2:/*paging*/            $arrData = $oDB->stl_GetAllRecord($start, $numOfRecord);            $totalRecord = $oDB->stl_TotalRecord();            $content = stl_printData($dirPhoto, $arrData, STL_TMPL, $view, $start);            $paging->assign($page,"onclick=\"ArtistComposer.stl_Paging([:page:])\"" ,  $totalRecord , $rowinpage );            $arrResponse = array('content'=>$content,'paging'=>$paging->fetch());			$arrResponse = json_encode($arrResponse);            echo $arrResponse;        break;        case 1:/*update table*/            $ID = $_POST['ID'];			            $arrInfo = stripslashes($_POST['arrInfo']);			$arrInfoImage = json_decode($arrInfo);            $result = $oDB->stl_UpdateRecord($ID, $arrInfo);			if("NG" == $result){            }else{                if ($arrInfoImage[3]!=""){                    $p = new STL_UploadFile();                    if(file_exists(DIR_PHOTO_TEMP.$arrInfoImage[3])){						rename(DIR_PHOTO_TEMP.$arrInfoImage[3], DIR_PHOTO.$arrInfoImage[3]);												$p->stl_DeleteFile(DIR_PHOTO_TEMP . $arrInfoImage[3]);					}                }            }            echo $result;        break;               default :			$arrData = $oDB->stl_GetAllRecord($start, $numOfRecord);			            $totalRecord = $oDB->stl_TotalRecord();        	$data["content"] = stl_printData($dirPhoto, $arrData, STL_TMPL, $view, $start);            $paging->assign($page,"onclick=\"ArtistComposer.stl_Paging([:page:])\"" ,  $totalRecord , $rowinpage );            $data['paging'] = $paging->fetch();			$data['UserName'] = $_SESSION['admin_User'];			$view->showTmpl( STL_TMPL.'G_Main.tmpl', 'n', $data);        break;    }	    function stl_printData($table, $arrData, $MOD_TMPL, $view, $start=1){        $i =  $start + 1; if($i<1) $i =1;        $content = "";	        foreach($arrData as $row)		{            $dataRow["num"]         = $i%2;            $dataRow["STT"]         = $i; $i++;            $dataRow["ID"]          = $row->ID;            $dataRow["Name"]        = htmlspecialchars($row->Name, ENT_QUOTES);            $dataRow["Description"]        = htmlspecialchars($row->Description, ENT_QUOTES);            $dataRow["Price"]       = htmlspecialchars($row->Price, ENT_QUOTES);                       $dataRow["Image"]  = $row->Image == "" ? "default.gif":$row->Image;            $dataRow["CreateDate"]  = $row->CreateDate;            $dataRow["LastUpdate"]  = $row->LastUpdate;            $dataRow["IsDeleted"]  = $row->IsDeleted;			$dataRow['pTable']		= $table;			if(2 == $row->IsDeleted) $dataRow['titleD'] = "Phục hồi"; else $dataRow['titleD'] = "Xoá";			if(2 == $row->IsDeleted) $dataRow['displayE'] = "return; "; else $dataRow['displayE'] = "";			            $content .= $view->returnTmpl($MOD_TMPL."g_row.tmpl", 'n', $dataRow);        }        return $content;    }   ?>